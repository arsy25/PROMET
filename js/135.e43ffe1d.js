"use strict";(globalThis["webpackChunkiotapp"]=globalThis["webpackChunkiotapp"]||[]).push([[135],{9135:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ee});var s=a(1758),r=a(8790);const i={class:"row q-gutter-sm"},c={class:"row q-pa-md"},l={class:"col q-ml-md"},o={class:"text-subtitle1 text-white"},d={class:"text-h5"},n={class:"row q-pa-md"},u={class:"col q-ml-md"},p={class:"text-subtitle1 text-white"},g={class:"text-h5"},m={class:"row q-gutter-sm"},h={key:0},v={class:"q-gutter-sm"},k={class:"q-mb-none text-center"},b={class:"q-mb-none text-center"},f={key:1},L={class:"row q-gutter-sm"},x={class:"row q-pa-md"},F={class:"col q-ml-md"},w={class:"text-subtitle1 text-white"},_={class:"text-h5"},y={class:"row q-pa-md"},C={class:"col q-ml-md"},q={class:"text-subtitle1 text-white"},D={class:"text-h5"},S={class:"row q-pa-md"},A={class:"col q-ml-md"},N={class:"text-subtitle1 text-white"},z={class:"text-h5"},I={class:"row q-gutter-sm"},O={key:0},T={class:"q-gutter-sm"},$={class:"q-mb-none text-center"},J={class:"q-mb-none text-center"},W={key:1};function B(e,t,a,B,U,X){const E=(0,s.g2)("q-icon"),M=(0,s.g2)("q-card"),Q=(0,s.g2)("l-tile-layer"),j=(0,s.g2)("q-btn"),P=(0,s.g2)("l-popup"),K=(0,s.g2)("l-marker"),R=(0,s.g2)("l-map"),V=(0,s.g2)("q-page");return e.$q.platform.is.mobile?((0,s.uX)(),(0,s.Wv)(V,{key:0,class:"q-pa-md bg-dark"},{default:(0,s.k6)(()=>[t[5]||(t[5]=(0,s.Lk)("p",{class:"textt text-white text-h4"},"Dashboard",-1)),(0,s.Lk)("div",i,[(0,s.bF)(M,{class:"col-12 cardd q-mb-md bg-negative"},{default:(0,s.k6)(()=>[(0,s.Lk)("div",c,[(0,s.bF)(E,{class:"col-4",size:"70px",name:"people",color:"white"}),(0,s.Lk)("div",l,[t[1]||(t[1]=(0,s.Lk)("div",{class:"text-h6 text-white"},"Users",-1)),(0,s.Lk)("div",o,[(0,s.Lk)("b",d,(0,r.v_)(U.userCount),1),t[0]||(t[0]=(0,s.eW)(" Active ",-1))])])])]),_:1}),(0,s.bF)(M,{class:"col cardd q-mb-md bg-negative"},{default:(0,s.k6)(()=>[(0,s.Lk)("div",n,[(0,s.bF)(E,{class:"col-4",size:"70px",name:"local_fire_department",color:"white"}),(0,s.Lk)("div",u,[t[3]||(t[3]=(0,s.Lk)("div",{class:"text-h6 text-white"},"Device Active",-1)),(0,s.Lk)("div",p,[(0,s.Lk)("b",g,(0,r.v_)(U.deviceCount),1),t[2]||(t[2]=(0,s.eW)(" Active ",-1))])])])]),_:1})]),t[6]||(t[6]=(0,s.Lk)("p",{class:"textt text-white text-h6"},"Device Location",-1)),(0,s.Lk)("div",m,[(0,s.bF)(M,{class:"col cardd q-mb-md bg-negative",style:{height:"400px"}},{default:(0,s.k6)(()=>[(0,s.bF)(R,{ref:"map",style:{height:"100%",width:"100%"},zoom:6,center:U.mapCenter},{default:(0,s.k6)(()=>[(0,s.bF)(Q,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(X.validDevices,e=>((0,s.uX)(),(0,s.Wv)(K,{key:e.mac_address,latLng:[parseFloat(e.latitude),parseFloat(e.longitude)],icon:X.isFireDetected(e)?U.fireIcon:U.defaultIcon,onClick:t=>X.handleMarkerClick(e)},{default:(0,s.k6)(()=>[(0,s.bF)(P,null,{default:(0,s.k6)(()=>[(0,s.bF)(M,{class:"cardd bg-dark q-pa-md text-white"},{default:(0,s.k6)(()=>[(0,s.Lk)("div",null,[(0,s.Lk)("p",null,[t[4]||(t[4]=(0,s.Lk)("b",null,"Device Name:",-1)),(0,s.eW)(" "+(0,r.v_)(e.device_name),1)]),e.data?((0,s.uX)(),(0,s.CE)("div",h,[(0,s.Lk)("div",v,[(0,s.bF)(M,{class:(0,r.C4)([X.getTempBadge(e.data),"q-pa-sm cardd items-center"])},{default:(0,s.k6)(()=>[(0,s.Lk)("p",k,(0,r.v_)(X.getTemperature(e.data))+"°C ",1)]),_:2},1032,["class"]),(0,s.bF)(M,{class:(0,r.C4)([X.getFireBadge(e.data),"q-pa-sm cardd items-center"])},{default:(0,s.k6)(()=>[(0,s.Lk)("p",b,(0,r.v_)(X.getFirestate(e.data)),1)]),_:2},1032,["class"])])])):((0,s.uX)(),(0,s.CE)("p",f,"No realtime data"))]),(0,s.bF)(j,{label:"See Details",color:"black",unelevated:"",class:"text-capitalize q-mt-md full-width button-cuy",onClick:t=>X.goToDeviceDetail(e.mac_address)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["latLng","icon","onClick"]))),128))]),_:1},8,["center"])]),_:1})])]),_:1,__:[5,6]})):((0,s.uX)(),(0,s.Wv)(V,{key:1,class:"q-pa-md bg-dark"},{default:(0,s.k6)(()=>[t[14]||(t[14]=(0,s.Lk)("p",{class:"textt text-white text-h4"},"Dashboard",-1)),(0,s.Lk)("div",L,[(0,s.bF)(M,{class:"col cardd q-mb-md bg-negative"},{default:(0,s.k6)(()=>[(0,s.Lk)("div",x,[(0,s.bF)(E,{class:"col-4",size:"70px",name:"people",color:"white"}),(0,s.Lk)("div",F,[t[8]||(t[8]=(0,s.Lk)("div",{class:"text-h6 text-white"},"Users",-1)),(0,s.Lk)("div",w,[(0,s.Lk)("b",_,(0,r.v_)(U.userCount),1),t[7]||(t[7]=(0,s.eW)(" Active ",-1))])])])]),_:1}),(0,s.bF)(M,{class:"col cardd q-mb-md bg-negative"},{default:(0,s.k6)(()=>[(0,s.Lk)("div",y,[(0,s.bF)(E,{class:"col-4",size:"70px",name:"people",color:"white"}),(0,s.Lk)("div",C,[t[10]||(t[10]=(0,s.Lk)("div",{class:"text-h6 text-white"},"Users",-1)),(0,s.Lk)("div",q,[(0,s.Lk)("b",D,(0,r.v_)(U.userCount),1),t[9]||(t[9]=(0,s.eW)(" Active ",-1))])])])]),_:1}),(0,s.bF)(M,{class:"col cardd q-mb-md bg-negative"},{default:(0,s.k6)(()=>[(0,s.Lk)("div",S,[(0,s.bF)(E,{class:"col-4",size:"70px",name:"local_fire_department",color:"white"}),(0,s.Lk)("div",A,[t[12]||(t[12]=(0,s.Lk)("div",{class:"text-h6 text-white"},"Device Active",-1)),(0,s.Lk)("div",N,[(0,s.Lk)("b",z,(0,r.v_)(U.deviceCount),1),t[11]||(t[11]=(0,s.eW)(" Active ",-1))])])])]),_:1})]),t[15]||(t[15]=(0,s.Lk)("p",{class:"textt text-white text-h6"},"Device Location",-1)),(0,s.Lk)("div",I,[(0,s.bF)(M,{class:"col cardd q-mb-md bg-negative",style:{height:"400px"}},{default:(0,s.k6)(()=>[(0,s.bF)(R,{ref:"map",style:{height:"100%",width:"100%"},zoom:6,center:U.mapCenter},{default:(0,s.k6)(()=>[(0,s.bF)(Q,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(X.validDevices,e=>((0,s.uX)(),(0,s.Wv)(K,{key:e.mac_address,latLng:[parseFloat(e.latitude),parseFloat(e.longitude)],icon:X.isFireDetected(e)?U.fireIcon:U.defaultIcon,onClick:t=>X.handleMarkerClick(e)},{default:(0,s.k6)(()=>[(0,s.bF)(P,null,{default:(0,s.k6)(()=>[(0,s.bF)(M,{class:"cardd bg-dark q-pa-md text-white"},{default:(0,s.k6)(()=>[(0,s.Lk)("div",null,[(0,s.Lk)("p",null,[t[13]||(t[13]=(0,s.Lk)("b",null,"Device Name:",-1)),(0,s.eW)(" "+(0,r.v_)(e.device_name),1)]),e.data?((0,s.uX)(),(0,s.CE)("div",O,[(0,s.Lk)("div",T,[(0,s.bF)(M,{class:(0,r.C4)([X.getTempBadge(e.data),"q-pa-sm cardd items-center"])},{default:(0,s.k6)(()=>[(0,s.Lk)("p",$,(0,r.v_)(X.getTemperature(e.data))+"°C ",1)]),_:2},1032,["class"]),(0,s.bF)(M,{class:(0,r.C4)([X.getFireBadge(e.data),"q-pa-sm cardd items-center"])},{default:(0,s.k6)(()=>[(0,s.Lk)("p",J,(0,r.v_)(X.getFirestate(e.data)),1)]),_:2},1032,["class"])])])):((0,s.uX)(),(0,s.CE)("p",W,"No realtime data"))]),(0,s.bF)(j,{label:"See Details",color:"black",unelevated:"",class:"text-capitalize q-mt-md full-width button-cuy",onClick:t=>X.goToDeviceDetail(e.mac_address)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["latLng","icon","onClick"]))),128))]),_:1},8,["center"])]),_:1})])]),_:1,__:[14,15]}))}a(310),a(5962),a(6724);var U=a(7024),X=a(9032),E=a.n(X);const M=E().icon({iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png",shadowSize:[41,41]}),Q=E().icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png",shadowSize:[41,41]}),j={name:"IndexPage",components:{LMap:U.Do,LTileLayer:U.a,LMarker:U.li,LPopup:U.nA},data(){return{devices:[],mapCenter:[0,0],selectedDevice:null,defaultIcon:M,userCount:0,deviceCount:0,fireIcon:Q}},computed:{validDevices(){return this.devices.filter(e=>{const t=parseFloat(e.latitude),a=parseFloat(e.longitude);return!isNaN(t)&&!isNaN(a)})}},mounted(){this.fetchDevices(),this.fetchUserCount(),this.fetchDeviceCount(),this.$nextTick(()=>{this.$refs.map&&this.$refs.map.mapObject&&this.$refs.map.mapObject.invalidateSize()}),this.intervalId=setInterval(()=>{this.fetchDevices()},500)},beforeUnmount(){clearInterval(this.intervalId)},methods:{async fetchDevices(){try{const e=localStorage.getItem("token"),t=await this.$api.get("/devices/realtime/all/devices",{headers:{Authorization:`Bearer ${e}`}});this.devices=Array.isArray(t.data.data)?t.data.data:[],this.validDevices.length>0&&(this.mapCenter=[parseFloat(this.validDevices[0].latitude),parseFloat(this.validDevices[0].longitude)])}catch(e){console.error("Failed to fetch devices",e)}},handleMarkerClick(e){this.selectedDevice=e},async fetchUserCount(){try{const e=localStorage.getItem("token"),t=await this.$api.get("/users/count",{headers:{Authorization:`Bearer ${e}`}});this.userCount=t.data.count||0}catch(e){console.error("Failed to fetch user count",e)}},async fetchDeviceCount(){try{const e=localStorage.getItem("token"),t=await this.$api.get("/devices/count/status/online",{headers:{Authorization:`Bearer ${e}`}});this.deviceCount=t.data.count||0}catch(e){console.error("Failed to fetch user count",e)}},goToDeviceDetail(e){this.$router.push({name:"DEVICEDETAIL",params:{mac_address:e}})},isFireDetected(e){if(!e.data||!e.data.data)return!1;let t=e.data.data;if("string"===typeof t)try{t=JSON.parse(t)}catch(e){return console.error("Failed to parse realtime data:",e),!1}return console.log("Realtime api value:",t.api),t.api&&"string"===typeof t.api&&t.api.toLowerCase().includes("fire detected")},getTemperature(e){if(!e||!e.data)return"-";try{const t="string"===typeof e.data?JSON.parse(e.data):e.data;return void 0!==t.temperature?parseFloat(t.temperature).toFixed(2):"-"}catch(e){return console.error("JSON parse error:",e),"-"}},getTempBadge(e){const t=this.getTemperature(e);return t<40?"bg-green":t<60?"bg-orange":"bg-negative"},getFireNotif(e){if(!e||!e.data||!e.data.data)return"-";try{const t="string"===typeof e.data.data?JSON.parse(e.data.data):e.data.data;return void 0!==t.api?t.api:"-"}catch(e){return console.error("JSON parse error:",e),"-"}},getFirestate(e){if(!e)return"-";if(e.data){if("string"!==typeof e.data)return"object"===typeof e.data&&null!==e.data&&void 0!==e.data.api?e.data.api:"-";try{const t=JSON.parse(e.data);return void 0!==t.api?t.api:"-"}catch(e){return console.error("JSON parse error:",e),"-"}}else if(void 0!==e.api)return e.api;return"-"},getFireBadge(e){const t=this.getFirestate(e);return"fire detected!"===t?"bg-negative":"no fire"===t?"bg-green":"bg-grey"},getSirenstate(e){if(!e||!e.data)return"-";try{const t="string"===typeof e.data?JSON.parse(e.data):e.data;return void 0!==t.relay?t.relay:"-"}catch(e){return console.error("JSON parse error:",e),"-"}},getSirenbadge(e){const t=this.getSirenstate(e);return"ON"===t?"bg-negative":"OFF"===t?"bg-green":"bg-grey"},getSmokestate(e){if(!e||!e.data)return"-";try{const t="string"===typeof e.data?JSON.parse(e.data):e.data;return void 0!==t.smoke?t.smoke:"-"}catch(e){return console.error("JSON parse error:",e),"-"}},getSmokebadge(e){const t=this.getSmokestate(e);return"smoke detected!"===t?"bg-negative":"no smoke"===t?"bg-green":"bg-grey"}}};var P=a(2807),K=a(7716),R=a(3316),V=a(492),G=a(1693),H=a(8582),Y=a.n(H);const Z=(0,P.A)(j,[["render",B]]),ee=Z;Y()(j,"components",{QPage:K.A,QCard:R.A,QIcon:V.A,QBtn:G.A})}}]);